<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <title>Admin Paneli</title>
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>
<header>
    <h1>Admin Paneli</h1>
    <nav>
        <a href="index.html">Ana Sayfa</a>
        <a href="login.html">Çıkış</a>
    </nav>
</header>

<main>
    <section id="products">
        <h2>Ürünler</h2>

        <form id="product-form">
            <input type="hidden" id="product-id" />
            <input type="text" id="name" placeholder="Ürün Adı" required />
            <input type="text" id="description" placeholder="Açıklama" />
            <input type="number" id="price" placeholder="Fiyat" required min="0" step="0.01" />

            <!-- ⚠️ id düzeltildi: category-select -->
            <select id="category-select" required>
                <option value="" selected disabled>Kategori seçin</option>
            </select>

            <!-- Resim yolu -->
            <input type="text" id="imageUrl" placeholder="Resim yolu (/img/xxx.jpg)" />
            <img id="image-preview" style="width:140px;height:90px;object-fit:cover;border-radius:6px;margin-top:8px;display:none;" />

            <button type="submit">Kaydet</button>
        </form>

        <table id="product-list">
            <thead>
            <tr>
                <th>ID</th>
                <th>Ad</th>
                <th>Açıklama</th>
                <th>Fiyat</th>
                <th>İşlemler</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </section>

    <section>
        <h2>Kategori Yönetimi</h2>
        <form id="category-form">
            <input type="text" id="category-name" placeholder="Yeni kategori adı" required />
            <button type="submit">Ekle</button>
        </form>
        <ul id="category-list"></ul>
    </section>

    <div id="message" class="message"></div>
</main>

<script>
    // Yetki kontrolü
    (function() {
      const token = localStorage.getItem("token");
      if (!token) { window.location.href = "login.html"; return; }
      try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        if (!payload.roles || !payload.roles.includes("ROLE_ADMIN")) {
          window.location.href = "index.html";
        }
      } catch (e) { window.location.href = "login.html"; }
    })();
</script>

<!-- Scriptler en sonda -->
<script src="js/api.js"></script>
<script src="js/admin.js"></script>

<script>
    // Resim önizleme
    const imageUrlInput = document.getElementById('imageUrl');
    const imagePreview = document.getElementById('image-preview');
    if (imageUrlInput) {
      imageUrlInput.addEventListener('input', () => {
        const v = (imageUrlInput.value || '').trim();
        if (v) {
          imagePreview.src = v.startsWith('http') ? v : (v.startsWith('/') ? v : '/' + v);
          imagePreview.style.display = 'block';
        } else {
          imagePreview.style.display = 'none';
        }
      });
    }
</script>

</body>
</html>
